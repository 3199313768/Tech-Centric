# 碎片知识库（Knowledge Base）问题审查文档

基于对代码库 `src/app/knowledge/*` 和 `src/components/knowledge/*` 的深度审查，发现以下亟待解决的功能缺陷与技术隐患：

## 1. 严重功能异常或缺失 (Critical Issues)
- **CRUD 流程断裂 (未实现修改/删除)**：系统内 `RecordCard.tsx` 及管理主界面未提供修改既往产生数据的修改入口和删除防误触机制，用户输入有误后无法撤回纠错。
- **标签过滤交互为空壳代码 (逻辑失效)**：在 `src/app/knowledge/page.tsx` 中侧边栏渲染了标签列表（`uniqueTags` 遍历），但元素无附加 `<Link>` 行为或 `onClick` 路由跳转事件。点击任何标签均无反应，系统实质并未达成依据 Tag 的过滤闭环。
- **移动端应用处于废弃状态 (入口缺失)**：添加记录的核心组件 `QuickRecordModal.tsx` 依赖 `useKeyPressEvent` 的键盘触发，由于 UI 上无手动激活按钮，整个手机端环境等同于“只读模式”。

## 2. 性能与底层架构缺陷 (Architecture Issues)
- **暴力计算造成的标签体系失真**：`page.tsx` 获取 Tag 侧边栏数据的逻辑极不严谨。通过 `limit(100)` 获取最近 100 条记录再用 `.flatMap` 在服务端推算出来的并非全局真实标签库，当数据超过数百条后，旧标签将永远在侧边栏消失。
- **隐性的数据截断瓶颈**：主列表数据请求被死锁在 `.limit(50)` （位于 `page.tsx` 第56行）。缺乏基于游标或页码机制的数据拉取逻辑，所有超过前 50 条之外的历史知识片段目前处于后端不可触达状态。
- **弱网与常驻环境下的图片失效危机**：`RecordCard.tsx` 图片渲染依赖每次获取 1 小时生命周期的 Signed URL。对于单页应用长时间驻留场景，若用户在此页面停留或闲置超出 1 小时再去滚动查看历史或全屏查看原图，图片必定会出现 403 过期错误。

## 3. 防御性编程弱点 (Edge Cases)
- **缺乏文件体积拦截**：在 `QuickRecordModal.tsx` 中（位于第82行以后文件处理逻辑），向 `supabase.storage` 进行上传动作前，未进行 `file.size` 的前置检查。一旦错误粘贴数百 MB 的非法内容，将会引发游览器长期卡死并浪费服务器存储与算力资源。
- **表单异步清空带来的时序幽灵问题**：弹窗关闭存在 `setTimeout 300ms` 的退出延时清理机制。倘若遭遇慢网络状况并且用户发生多次重复提交点击，很可能触发脏数据二次提交等数据竞态错误。建议调整 Submit 执行流程，明确限制多次触碰以及确保表单真正清理。
