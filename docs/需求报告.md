# 碎片知识库（Knowledge Base）产品需求报告 (PRD)

## 1. 产品定位与目标
- **定位**：集成于个人技术主页的私有化、轻量级碎片知识管理模块。
- **目标**：提供极速的多模态内容（文本、代码、图片、附件）捕获与聚合检索体验。

## 2. 核心功能现状 (As-is)
- **快捷录入 (Quick Capture)**：
  - 通过全局快捷键 (Cmd+K / Ctrl+Space) 呼唤录入弹窗。
  - 支持四种内容类型：笔记 (Text)、代码 (Code)、图片 (Image)、附件 (File)。
  - 支持直接粘贴图片读取并渲染预览，提供自定义 Tag 标签输入。
  - 自动将多媒体资源上传至 Supabase Storage，并将记录结构化落库至 PostgreSQL (`kb_records` 表)。
- **内容消费与检索 (View & Search)**：
  - 采用响应式瀑布流 (Masonry Layout) 展示知识卡片。
  - 代码块支持语法高亮及一键复制。
  - 支持全文搜索检索、多内容类型过滤（笔记/代码/附件/图片过滤）。
- **权限管理 (Auth)**：
  - 存在硬性登录策略，未登录状态自动阻断并要求经过 `LoginForm` 鉴权，保护私有知识库数据。

## 3. 下一步需求迭代规划 (To-be)
基于现状审查，明确以下各优级的迭代规划：

### 3.1 核心数据闭环与可用支撑 (P0)
- **补全增删改查 (CRUD) 闭环**：当前仅支持新建和读取。必须增加针对历史记录的编辑 (Update) 与删除 (Delete) 操作。
- **移动端录入入口机制**：纯触屏设备无法触发键盘事件 (Cmd+K)。需在全局 Navigation 或页面浮动区域补充可见的录入按钮 (+ Icon)，保障移动端创建可用性。

### 3.2 数据规模化与检索增强 (P1)
- **无限加载与分页机制**：摒弃当前的硬编码获取上限 (`.limit(50)`)，引入拉网式翻页或无限下拉 (Infinite Scroll) 组件，支撑真实环境下的海量知识沉淀。
- **标签云及侧栏交互补全**：
  - 更改现有标签云生成逻辑：摒弃基于最近 100 条推算的伪全量标签，需由后端（Supabase RPC）进行真实的全局聚合。
  - 完成侧边栏标签点击触发 URL 路由更新的交互，真正实现基于标签的多维筛选过滤。

### 3.3 体验缺陷与边界防护 (P2)
- **资源上传校验规则**：为避免服务滥用，前端录入弹窗在提交大文件（图片/附件）前必须加入体积拦截逻辑（如 max-size <= 5MB 或 10MB）。
- **知识上下文扩展**：可以进一步为“代码”类型扩展显式的编程语言选择器（目前基于 highlight.js 自动推断，存在容错偏差）。此功能视需求复杂度可后置。
